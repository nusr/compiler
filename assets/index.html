<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compiler</title>
    <style>
      #code {
        width: 600px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <div>
      <textarea id="code">print 1;</textarea>
    </div>
    <div>
      <button id="run">run</button>
    </div>
    <div>
      <span id="result"></span>
    </div>
    <script src="../lib/lox.umd.js"></script>
    <script>
      const { Lox, eventEmitter, Environment } = window.lox;
      const dom = document.querySelector('#code');
      const button = document.querySelector('#run');
      const result = document.querySelector('#result');

      eventEmitter.on('print', (data) => {
        if (result) {
          const time = new Date().toLocaleString();
          result.innerHTML =
            result.innerHTML +
            `<div>time: ${time}, result: ${
              data.value
            }, type: ${typeof data.value}</div>`;
        }
      });

      if (button) {
        const localKey = 'local_key';
        window.localStorage.setItem('debug', '*');
        const temp = localStorage.getItem(localKey);
        if (temp && dom) {
          dom.value = temp;
          new Lox().run(temp, new Environment(null));
        }
        button.addEventListener('click', () => {
          const text = dom?.value || '';
          new Lox().run(text, new Environment(null));
          localStorage.setItem(localKey, text);
        });
      }
    </script>
  </body>
</html>
